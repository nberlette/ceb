<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Import fontawesome for icons-->
  <link rel="stylesheet" href="https://opensource.keycdn.com/fontawesome/4.7.0/font-awesome.min.css"
        integrity="sha384-dNpIIXE8U05kAbPhy3G1cz+yZmTzA6CY8Vg/u2L9xRnHjJiAK76m2BIEaSEV+/aU" crossorigin="anonymous">
  <!-- Import the polyfill to provide the CustomElement implementation if required-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/document-register-element/1.3.0/document-register-element.js"
          crossorigin="anonymous"></script>
  <!-- Import the ceb library -->
  <script src="live/dist/umd/ceb.min.js"></script>
  <style>
    ceb-video {
      display: block;
      height: auto;
      width: auto;
    }

    ceb-video video {
      width: 100%;
    }

    ceb-video .controls {
      display: flex;
      align-items: center;
    }

    ceb-video .controls [name=duration] {
      flex: 3;
    }

    ceb-video .controls [name=volume] {
      flex: 1;
    }
  </style>
</head>

<!-- Define and register the CustomElement 'ceb-input'. -->
<script>
  var cebVideoBuilder = ceb.element();
</script>

<!-- Template of ceb-video. -->
<script id="ceb-video-template" type="text/html">
  <video ceb-content></video>
  <div class="controls" style="display: none">
    <button type="button" name="play"><i class="fa fa-play fa-fw"></i></button>
    <button type="button" name="pause" hidden><i class="fa fa-pause fa-fw"></i></button>
    <button type="button" name="stop"><i class="fa fa-stop fa-fw"></i></button>
    <input type="range" name="duration" min="0" step="0.1">
    <button type="button" name="mute"><i class="fa fa-volume-off fa-fw"></i></button>
    <button type="button" name="unmute"><i class="fa fa-volume-up fa-fw"></i></button>
    <input type="range" name="volume" min="0" max="1" step="0.05">
  </div>
</script>

<!-- Set the template. -->
<script>
  cebVideoBuilder.builders(
    ceb.template(document.getElementById('ceb-video-template').innerHTML),
    ceb.property('video').getter(function (el) {
      return el.querySelector('video');
    })
  );
</script>

<!-- Toggle custom controls. -->
<script>
  cebVideoBuilder.builders(
    // When the attibute/property controls is true,
    // the controls have to be visible otherwise it should be hidden.
    ceb.attribute('controls').boolean().listen(function (el, oldVal, newVal) {
      el.querySelector('.controls').style.display = newVal ? '' : 'none';
    })
  );
</script>

<!-- Manage play/pause/stop. -->
<script>
  cebVideoBuilder.builders(
    ceb.on('canplay video, play video, pause video, ended video').invoke(function (el) {
      el.querySelector('.controls [name=play]').hidden = !el.video.paused && !el.video.ended;
      el.querySelector('.controls [name=pause]').hidden = el.video.paused;
    }),
    ceb.on('click').delegate('video, .controls [name=play], .controls [name=pause]').invoke(function (el) {
      if (el.video.paused) {
        el.video.play();
      } else {
        el.video.pause();
      }
    }),
    ceb.on('click').delegate('.controls [name=stop]').invoke(function (el, evt) {
      el.video.pause();
      el.video.currentTime = 0;
    })
  );
</script>

<!-- Manage volume. -->
<script>
  cebVideoBuilder.builders(
    ceb.on('canplay video, volumechange video').invoke(function (el) {
      el.querySelector('.controls [name=mute]').hidden = el.video.muted;
      el.querySelector('.controls [name=unmute]').hidden = !el.video.muted;
      el.querySelector('.controls [name=volume]').value = el.video.volume;
    }),
    ceb.on('click').delegate('.controls [name=mute], .controls [name=unmute]').invoke(function (el) {
      el.video.muted = !el.video.muted;
    }),
    ceb.on('input,change').delegate('.controls [name=volume]').invoke(function (el, evt, input) {
      el.video.volume = input.value;
    })
  );
</script>

<!-- Manage duration. -->
<script>
  cebVideoBuilder.builders(
    ceb.on('loadeddata video, timeupdate video').invoke(function (el) {
      el.querySelector('.controls [name=duration]').max = el.video.duration;
      el.querySelector('.controls [name=duration]').value = el.video.currentTime;
    }),
    ceb.on('change,input').delegate('.controls [name=duration]').invoke(function (el, evt) {
      if (!el.video.seeking) {
        el.video.currentTime = evt.target.value;
      }
    })
  );
</script>

<!-- Expose the API of the video element from the custom element. -->
<script>
  cebVideoBuilder.builders(
    // attributes
    ceb.delegate(ceb.attribute('src')).to('video'),
    ceb.delegate(ceb.attribute('crossorigin')).to('video'),
    ceb.delegate(ceb.attribute('poster')).to('video'),
    ceb.delegate(ceb.attribute('preload')).to('video'),
    ceb.delegate(ceb.attribute('autoplay').boolean()).to('video'),
    ceb.delegate(ceb.attribute('mediagroup')).to('video'),
    ceb.delegate(ceb.attribute('loop').boolean()).to('video'),
    ceb.delegate(ceb.attribute('muted').boolean()).to('video'),
    ceb.delegate(ceb.attribute('width')).to('video'),
    ceb.delegate(ceb.attribute('height')).to('video'),
    // properties
    ceb.delegate(ceb.property('error')).to('video'),
    ceb.delegate(ceb.property('currentSrc')).to('video'),
    ceb.delegate(ceb.property('networkState')).to('video'),
    ceb.delegate(ceb.property('readyState')).to('video'),
    ceb.delegate(ceb.property('seeking')).to('video'),
    ceb.delegate(ceb.property('currentTime')).to('video'),
    ceb.delegate(ceb.property('duration')).to('video'),
    ceb.delegate(ceb.property('paused')).to('video'),
    ceb.delegate(ceb.property('defaultPlaybackRate')).to('video'),
    ceb.delegate(ceb.property('playbackRate')).to('video'),
    ceb.delegate(ceb.property('played')).to('video'),
    ceb.delegate(ceb.property('seekable')).to('video'),
    ceb.delegate(ceb.property('ended')).to('video'),
    ceb.delegate(ceb.property('controller')).to('video'),
    ceb.delegate(ceb.property('volume')).to('video'),
    ceb.delegate(ceb.property('defaultMuted')).to('video'),
    ceb.delegate(ceb.property('audioTracks')).to('video'),
    ceb.delegate(ceb.property('videoTracks')).to('video'),
    ceb.delegate(ceb.property('textTracks')).to('video'),
    // methods
    ceb.delegate(ceb.method('canPlayType')).to('video'),
    ceb.delegate(ceb.method('getStartDate')).to('video'),
    ceb.delegate(ceb.method('play')).to('video'),
    ceb.delegate(ceb.method('pause')).to('video'),
    ceb.delegate(ceb.method('addTextTrack')).to('video')
  );
</script>

<script>
  cebVideoBuilder.register('ceb-video');
</script>

<!-- 'ceb-input' elements created from HTML ... -->
<ceb-video controls>
  <source src="https://www.html5rocks.com/en/tutorials/video/basics/devstories.webm"
          type='video/webm;codecs="vp8, vorbis"'/>
  <source src="https://www.html5rocks.com/en/tutorials/video/basics/devstories.mp4"
          type='video/mp4;codecs="avc1.42E01E, mp4a.40.2"'/>
</ceb-video>

</body>
</html>
